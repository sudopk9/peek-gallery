<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Peek Through My Lens</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #111;
    color: #eee;
    margin: 0;
    padding: 20px;
    text-align: center;
  }

  h1 { margin-bottom: 20px; }

  button {
    background: #333;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    margin-bottom: 15px;
    margin-right: 10px;
  }

  button:hover { background: #555; }

  .gallery {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
  }

  .gallery img {
    width: 250px;
    height: auto;
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,0.25);
    transition: transform 0.2s;
  }

  .gallery img:hover { transform: scale(1.03); }

  #lightbox {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.9);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 999;
    flex-direction: column;
  }

  #lightbox img {
    max-width: 90%;
    max-height: 80%;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(255,255,255,0.3);
  }

  .nav-arrow {
    position: fixed;
    top: 50%;
    transform: translateY(-50%);
    color: white;
    font-size: 3rem;
    cursor: pointer;
    user-select: none;
    padding: 10px;
    z-index: 1000;
  }

  #prevArrow { left: 20px; }
  #nextArrow { right: 20px; }

  #dots {
    display: flex;
    justify-content: center;
    margin-top: 15px;
    gap: 8px;
  }

  .dot {
    width: 12px;
    height: 12px;
    background: #555;
    border-radius: 50%;
    cursor: pointer;
    transition: background 0.3s;
  }

  .dot.active { background: #fff; }
</style>
</head>
<body>
<h1>Peek Through My Lens</h1>
<button id="slideshowBtn">▶ Play Slideshow</button>
<div class="gallery" id="gallery"></div>

<div id="lightbox">
  <span id="prevArrow" class="nav-arrow">&#10094;</span>
  <img id="lightboxImg" src="" alt="">
  <span id="nextArrow" class="nav-arrow">&#10095;</span>
  <div id="dots"></div>
</div>

<script>
const username = 'sudopk9';
const repo = 'peek-gallery';
const folderPath = 'photos';

let currentIndex = 0;
let imageList = [];
let slideshowInterval = null;

const gallery = document.getElementById('gallery');
const lightbox = document.getElementById('lightbox');
const lightboxImg = document.getElementById('lightboxImg');
const prevArrow = document.getElementById('prevArrow');
const nextArrow = document.getElementById('nextArrow');
const slideshowBtn = document.getElementById('slideshowBtn');
const dotsContainer = document.getElementById('dots');

async function loadImages() {
  const url = `https://api.github.com/repos/${username}/${repo}/contents/${folderPath}`;
  const res = await fetch(url);
  const files = await res.json();

  imageList = files.filter(f => f.name.match(/\.(jpg|jpeg|png|gif|webp)$/i));
  gallery.innerHTML = '';
  dotsContainer.innerHTML = '';

  imageList.forEach((file, i) => {
    // Thumbnail
    const imgThumb = document.createElement('img');
    imgThumb.dataset.src = file.download_url;
    imgThumb.loading = 'lazy';
    imgThumb.alt = file.name;
    imgThumb.onclick = () => openLightbox(i);
    gallery.appendChild(imgThumb);
    lazyLoadImage(imgThumb);

    // Dot
    const dot = document.createElement('div');
    dot.classList.add('dot');
    dot.onclick = () => { currentIndex = i; updateLightbox(); };
    dotsContainer.appendChild(dot);
  });

  updateLightbox();
}

function lazyLoadImage(img) {
  const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        img.src = img.dataset.src;
        observer.disconnect();
      }
    });
  });
  observer.observe(img);
}

function openLightbox(index) {
  currentIndex = index;
  updateLightbox();
  lightbox.style.display = 'flex';
}

function closeLightbox() {
  lightbox.style.display = 'none';
  stopSlideshow();
}

function updateLightbox() {
  if (imageList.length > 0) {
    lightboxImg.src = imageList[currentIndex].download_url;
    updateDots();
  }
}

function nextImage() { currentIndex = (currentIndex + 1) % imageList.length; updateLightbox(); }
function prevImage() { currentIndex = (currentIndex - 1 + imageList.length) % imageList.length; updateLightbox(); }

function startSlideshow() { slideshowBtn.textContent = '⏸ Pause Slideshow'; slideshowInterval = setInterval(nextImage, 3000); }
function stopSlideshow() { slideshowBtn.textContent = '▶ Play Slideshow'; clearInterval(slideshowInterval); slideshowInterval = null; }

slideshowBtn.onclick = () => { if (slideshowInterval) stopSlideshow(); else { openLightbox(currentIndex); startSlideshow(); } };
nextArrow.onclick = nextImage;
prevArrow.onclick = prevImage;

lightbox.onclick = e => { if (e.target === lightbox) closeLightbox(); };
document.addEventListener('keydown', e => {
  if (lightbox.style.display === 'flex') {
    if (e.key === 'ArrowRight') nextImage();
    else if (e.key === 'ArrowLeft') prevImage();
    else if (e.key === 'Escape') closeLightbox();
  }
});

function updateDots() {
  const dots = dotsContainer.querySelectorAll('.dot');
  dots.forEach((dot, i) => dot.classList.toggle('active', i === currentIndex));
}

loadImages();
</script>
</body>
</html>
